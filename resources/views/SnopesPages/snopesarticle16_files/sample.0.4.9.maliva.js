SlardarLite.plugin.sample=function(){"use strict";function f(r,n){var t="function"==typeof Symbol&&r[Symbol.iterator];if(!t)return r;var e,u,i=t.call(r),f=[];try{for(;(void 0===n||0<n--)&&!(e=i.next()).done;)f.push(e.value)}catch(r){u={error:r}}finally{try{e&&!e.done&&(t=i.return)&&t.call(i)}finally{if(u)throw u.error}}return f}function l(r){return r}var e=Object.prototype;function v(r,n){if("[object Array]"!==e.toString.call(r))return!1;if(0===r.length)return!1;for(var t=0;t<r.length;){if(r[t]===n)return!0;t++}return!1}function o(r){return Math.random()<Number(r)}function a(r,n){return r<Number(n)}function t(r,n,t,e){var u;return void 0!==(n=function(r,n,t){for(var e,n=f(n.split(".")),u=n[0],i=n.slice(1);r&&0<i.length;)r=r[u],u=(e=f(i))[0],i=e.slice(1);if(r)return t(r,u)}(r,n,function(r,n){return r[n]}))&&function(r,n,t){switch(t){case"eq":return v(n,r);case"neq":return!v(n,r);case"gt":return r>n[0];case"gte":return r>=n[0];case"lt":return r<n[0];case"lte":return r<=n[0];case"regex":return Boolean(r.match(new RegExp(n[0])));case"not_regex":return!r.match(new RegExp(n[0]));default:return!1}}(n,(u="boolean"==typeof n?"bool":"number"==typeof n?"number":"string",e.map(function(r){switch(u){case"number":return Number(r);case"boolean":return"1"===r;default:return String(r)}})),t)}function c(r,n,t,e){if(!n)return l;var o=n.sample_rate,u=n.include_users,i=n.sample_granularity,n=n.rules;if(v(u,r))return function(r){return s(r,1)};var a=m(o,i="session"===i,t),c=y(n,i,o,t,e);return function(r){var n,t;if(!a())return!1;if(!(r.ev_type in c))return s(r,o);if(!c[r.ev_type].enable)return!1;if(null!==(e=r.extra)&&void 0!==e&&e.sample_rate)return r;var e=c[r.ev_type];if(e.conditional_hit_rules)try{for(var u=function(r){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&r[n],e=0;if(t)return t.call(r);if(r&&"number"==typeof r.length)return{next:function(){return{value:(r=r&&e>=r.length?void 0:r)&&r[e++],done:!r}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e.conditional_hit_rules),i=u.next();!i.done;i=u.next()){var f=i.value;if(b(r,f.filter))return!!f.hit()&&s(r,f.effectiveSampleRate)}}catch(r){n={error:r}}finally{try{i&&!i.done&&(t=u.return)&&t.call(u)}finally{if(n)throw n.error}}return!!e.hit()&&s(r,e.effectiveSampleRate)}}var s=function(r,n){var t=r.extra||{};return t.sample_rate=n,r.extra=t,r},m=function(r,n,t){return n?(e=t(r),function(){return e}):function(){return t(r)};var e},b=function(n,r){try{return"rule"===r.type?t(n,r.field,r.op,r.values):"and"===r.type?r.children.every(function(r){return b(n,r)}):r.children.some(function(r){return b(n,r)})}catch(r){return!1}},y=function(a,c,l,v,s){var b={},y=Math.random();return Object.keys(a).forEach(function(r){var n,t,e,u=a[r],i=u.enable,f=u.sample_rate,o=u.conditional_sample_rules;i?(b[r]={enable:i,sample_rate:f,effectiveSampleRate:f*l,hit:(n=f,t=v,u=y,f=s,c?(e=f(u,n),function(){return e}):function(){return t(n)})},o&&(b[r].conditional_hit_rules=o.map(function(r){var n=r.sample_rate,r=r.filter;return{sample_rate:n,hit:m(n,c,v),effectiveSampleRate:n*l,filter:r}}))):b[r]={enable:i,hit:function(){return!1},sample_rate:0,effectiveSampleRate:0}}),b};return function(i,r){return r&&i.s(function(e){var u;r.u(function(r){var n=i.config,t=n.userId,n=n.sample;n!==u&&(u=n,i.sampler=c(t,n,o,a));r=i.sampler(r);r&&e(r)})})}}();
