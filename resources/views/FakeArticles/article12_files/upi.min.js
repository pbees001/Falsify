try {

	//global variable for async
	var propertag = propertag || {};
	propertag.cmd = propertag.cmd || [];

	//Set Options
	(function(win, document) {

		var ad_code_domain = "global.proper.io" || "global.proper.io"; // domain to load ad code from
		var session_persistent = 0; // User keeps same version id throughout session
		var last_release_ts = "2021-09-30 13:34:18";  // Last time a file was released from split test
		var publisher = "upi";
		var proper_ad_block_message = 0; // Flag if proper ad block message should be enabled

		var cookie_name = "proper_rtp_split_test";
		var cookieData  = {
			"version_id": null, // Session version id
			"release_ts": null  // Time this cookie was set
		}

		/**
		 * Rtp Files.
		 *
		 * If One Version:
		 *
		 * { version_id: config }
		 *
		 * If Split version:
		 *
		 * { version_id: rtp_version_id }
		 */

		// List of rtp files
		var rtp_files = {"9141":{"dfp_id":"1009753","domain":"upi.com","floors":{"mobile":{"sizes":{"400x300":2,"640x480":2},"backup":0.1},"desktop":{"sizes":{"400x300":2,"640x480":2},"backup":0.1}},"schain":{"ver":"1.0","nodes":[{"hp":1,"asi":"proper.io","sid":"f87d3dee-ba65-11eb-8272-06ef03bc0096"}],"complete":1},"bidders":{"s2s":{"gumgum_s2s":{"test":false,"enabled":true,"site_id":"rm3lr58d","tag_ids":{"mobile":[{"sticky_horizontal":["1"]}],"desktop":[{"sticky_horizontal":["1"]}]}},"mediagrid_s2s":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["83037","83039","83038","83040"],"300x250":["83037","83039"]}],"desktop":[{"728x90":["83031","83030","83034","83035"],"160x600":["83036","83033"],"300x250":["83031","83030","83032","83033"],"300x600":["83033"],"970x250":["83034","83035"]}]}},"aol_instream_s2s":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["mobile-1"]}],"desktop":[{"640x480":["desktop-1"]}]}},"aol_outstream_s2s":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"verizon_media_s2s":{"enabled":true,"site_id":"8a9695b5017979f794bcf7b743e7000e","tag_ids":{"mobile":[{"320x50":["8a969dea017979f78bd1f7bb9996005d-1","8a969dea017979f78bd1f7bb9996005d-2","8a969dea017979f78bd1f7bb9996005d-3","8a969dea017979f78bd1f7bb9996005d-4"],"300x250":["8a969dea017979f78bd1f7bb9996005d-1","8a969dea017979f78bd1f7bb9996005d-2"]}],"desktop":[{"728x90":["8a96912c017979f79059f7bb98a10037-1","8a96912c017979f79059f7bb98a10037-2","8a96912c017979f79059f7bb98a10037-6","8a96912c017979f79059f7bb98a10037-7"],"160x600":["8a96912c017979f79059f7bb98a10037-5","8a96912c017979f79059f7bb98a10037-4"],"300x250":["8a96912c017979f79059f7bb98a10037-1","8a96912c017979f79059f7bb98a10037-2","8a96912c017979f79059f7bb98a10037-3","8a96912c017979f79059f7bb98a10037-4"],"300x600":["8a96912c017979f79059f7bb98a10037-4"],"970x250":["8a96912c017979f79059f7bb98a10037-6","8a96912c017979f79059f7bb98a10037-7"]}]}}},"header":{"a9":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3","mobile-4"],"300x250":["mobile-1","mobile-2"]}],"desktop":[{"728x90":["desktop-1","desktop-2","desktop-6","desktop-7"],"160x600":["desktop-5","desktop-4"],"300x250":["desktop-1","desktop-2","desktop-3","desktop-4"],"300x600":["desktop-4"],"970x250":["desktop-6","desktop-7"]}]}},"aol":{"test":false,"enabled":false},"emx":{"enabled":true,"site_id":"148901","tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3","mobile-4"],"300x250":["mobile-1","mobile-2"]}],"desktop":[{"728x90":["desktop-1","desktop-2","desktop-6","desktop-7"],"160x600":["desktop-5","desktop-4"],"300x250":["desktop-1","desktop-2","desktop-3","desktop-4"],"300x600":["desktop-4"],"970x250":["desktop-6","desktop-7"]}]}},"index":{"enabled":true,"site_id":"679380","tag_ids":{"mobile":[{"320x50":["320x50-1","320x50-2","320x50-3","320x50-4"],"300x250":["300x250-1","300x250-2"]}],"desktop":[{"728x90":["728x90-1","728x90-2","728x90-3","728x90-4"],"160x600":["160x600-1","160x600-2"],"300x250":["300x250-1","300x250-2","300x250-3","300x250-4"],"300x600":["300x600-1"],"970x250":["970x90-1","970x90-2"]}]}},"kargo":{"enabled":false,"tag_ids":{"mobile":[{"320x50":["_sXhTBVhUIV"],"300x250":["_xtXzoBC7up"]}]}},"openx":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["544095248","544095247","544095252","21738218"],"300x250":["544095248","544095247"]}],"desktop":[{"728x90":["544095242","544095243","544095245","544095237"],"160x600":["544095246","544095241"],"300x250":["544095242","544095243","544095244","544095241"],"300x600":["544095241"],"970x250":["544095245","544095237"]}]}},"sovrn":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["916078","916079","916080","916081"],"300x250":["916076","916077"]}],"desktop":[{"728x90":["916068","916069","916070","916071"],"160x600":["916072","916073"],"300x250":["916063","916064","916065","916066"],"300x600":["916067"],"970x250":["916074","916075"]}]}},"teads":{"test":false,"enabled":true,"tag_ids":{"mobile":[{"320x50":["134226-147374-1","134226-147374-2","134226-147374-3","134226-147374-4"],"300x250":["134226-147374-1","134226-147374-2"],"native_vertical":["134227-147375-1","134227-147375-2","134227-147375-3"]}],"desktop":[{"728x90":["134226-147374-1","134226-147374-2","134226-147374-6","134226-147374-7"],"160x600":["134226-147374-5","134226-147374-4"],"300x250":["134226-147374-1","134226-147374-2","134226-147374-3","134226-147374-4"],"300x600":["134226-147374-4"],"970x250":["134226-147374-6","134226-147374-7"]}]}},"criteo":{"test":false,"enabled":true,"tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3","mobile-4"],"300x250":["mobile-1","mobile-2"]}],"desktop":[{"728x90":["desktop-1","desktop-2","desktop-6","desktop-7"],"160x600":["desktop-5","desktop-4"],"300x250":["desktop-1","desktop-2","desktop-3","desktop-4"],"300x600":["desktop-4"],"970x250":["desktop-6","desktop-7"]}]}},"gumgum":{"enabled":false},"mantis":{"test":false,"enabled":true,"site_id":"60ae66d26f5619000fb3f1b5","tag_ids":{"mobile":[{"320x50":["upi_320x50-1","upi_320x50-2"],"300x250":["upi_300x250-1","upi_300x250-2"]}],"desktop":[{"728x90":["upi_728x90-1","upi_728x90-2"],"160x600":["upi_160x600-1","upi_160x600-2"],"300x250":["upi_300x250-1","upi_300x250-2"],"300x600":["upi_300x600-1"],"970x250":["upi_970x250-1"]}]}},"sonobi":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["982d8f7c07844d579a06","cf2a0758296355b1354a","e2f48ed78ea63ddd4d22","e0e98e89da3c04e5b677"],"300x250":["9def47444028e5701c6a","e41142df22d92ff930c5"]}],"desktop":[{"728x90":["cf2bb5411fab49203c78","65af045d98064476e433","056c4736a5c456608315","91f1770b26be0ac35930"],"160x600":["8ff575ccba39cea32fe3","1ecd7247afceab653ff3"],"300x250":["e2af3ca8ed5d3bc9f6c1","619cf3af57e11375c2d7","be8701653a55fea338b5","8d7a181ba5b312ac8522"],"300x600":["9c4c249c50c5f1c2bdf0"]}]}},"rubicon":{"enabled":true,"site_id":"378202","tag_ids":{"mobile":[{"320x50":["2087934-1","2087934-2","2087934-3","2087934-4"],"300x250":["2087934-1","2087934-2"]}],"desktop":[{"728x90":["2087932-1","2087932-2","2087932-6","2087932-7"],"160x600":["2087932-5","2087932-4"],"300x250":["2087932-1","2087932-2","2087932-3","2087932-4"],"300x600":["2087932-4"],"970x250":["2087932-6","2087932-7"]}]}},"appnexus":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["21738208","21738210","21738213","21738224"],"300x250":["21738208","21738210"]}],"desktop":[{"728x90":["21738207","21738209","21738212","21738223"],"160x600":["21738214","21738222"],"300x250":["21738207","21738209","21738221","21738222"],"300x600":["21738222"],"970x250":["21738212","21738223"]}]}},"medianet":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3","mobile-4"],"300x250":["mobile-1","mobile-2"]}],"desktop":[{"728x90":["desktop-1","desktop-2","desktop-6","desktop-7"],"160x600":["desktop-5","desktop-4"],"300x250":["desktop-1","desktop-2","desktop-3","desktop-4"],"300x600":["desktop-4"],"970x250":["desktop-6","desktop-7"]}]}},"pubmatic":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3","mobile-4"],"300x250":["mobile-1","mobile-2"]}],"desktop":[{"728x90":["desktop-1","desktop-2","desktop-6","desktop-7"],"160x600":["desktop-5","desktop-4"],"300x250":["desktop-1","desktop-2","desktop-3","desktop-4"],"300x600":["desktop-4"],"970x250":["desktop-6","desktop-7"]}]}},"adyoulike":{"test":false,"enabled":true,"tag_ids":{"mobile":[{"320x50":["171bfb1dde363e6dd54fed39f8dcaa94","171bfb1dde363e6dd54fed39f8dcaa94","171bfb1dde363e6dd54fed39f8dcaa94","171bfb1dde363e6dd54fed39f8dcaa94"],"300x250":["9f0739f676429d147fc9203498d881ef","9f0739f676429d147fc9203498d881ef"]}],"desktop":[{"728x90":["361b5a2d4e976643711b4c32b33bb419","361b5a2d4e976643711b4c32b33bb419","361b5a2d4e976643711b4c32b33bb419","361b5a2d4e976643711b4c32b33bb419"],"160x600":["7afd861bc88170fa7cdcbcf91a962e70","7afd861bc88170fa7cdcbcf91a962e70"],"300x250":["0f75d3e63387237d6547f5a30dbee920","0f75d3e63387237d6547f5a30dbee920","0f75d3e63387237d6547f5a30dbee920","0f75d3e63387237d6547f5a30dbee920"],"300x600":["46f844a822991d724109133a6384eb87"]}]}},"rhythmone":{"enabled":true,"site_id":"235414","tag_ids":{"mobile":[{"320x50":["1","1","1","1"],"300x250":["1","1"]}],"desktop":[{"728x90":["1","1","1","1"],"160x600":["1","1"],"300x250":["1","1","1","1"],"300x600":["1"],"970x250":["1","1"]}]}},"triplelift":{"enabled":false},"ix_instream":{"enabled":true,"site_id":"719465-719466","tag_ids":{"mobile":[{"400x300":["mobile-1"]}],"desktop":[{"640x480":["desktop-1"]}]}},"justpremium":{"test":false,"enabled":true,"tag_ids":{"mobile":[{"sticky_horizontal":["122885"]}],"desktop":[{"sticky_horizontal":["122885"]}]}},"adx_instream":{"enabled":false},"districtmdmx":{"test":false,"enabled":false},"emx_instream":{"enabled":true,"site_id":"155383","tag_ids":{"mobile":[{"400x300":["mobile-1"]}],"desktop":[{"640x480":["desktop-1"]}]}},"ix_outstream":{"enabled":true,"site_id":"679381-679382","tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"sharethrough":{"enabled":true},"emx_outstream":{"enabled":true,"site_id":"154100","tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"smart_adserver":{"enabled":false},"spotx_instream":{"enabled":true,"site_id":"319353-319354","tag_ids":{"mobile":[{"400x300":["mobile-1"]}],"desktop":[{"640x480":["desktop-1"]}]}},"openx_outstream":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["545661641","545661644","545661645"]}],"desktop":[{"640x480":["545661640","545661642","545661643"]}]}},"spotx_outstream":{"enabled":true,"site_id":"317964-317965","tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"rubicon_instream":{"enabled":true,"site_id":"378202","tag_ids":{"mobile":[{"400x300":["2158788-1"]}],"desktop":[{"640x480":["2158788-1"]}]}},"sonobi_outstream":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["73538fe7c07cb85340d6","acfe649764aec7db9453","caf403dd7f120ff47280"]}],"desktop":[{"640x480":["b6bce00ab7f563cb81f9","63c19decfb42d70b677c","d12668ea9a7f80a9bfbf"]}]}},"pubmatic_instream":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["upi_instream_mobile"]}],"desktop":[{"640x480":["upi_instream_desktop"]}]}},"rubicon_outstream":{"enabled":true,"site_id":"160050","tag_ids":{"mobile":[{"400x300":["2087934-1","2087934-2","2087934-3"]}],"desktop":[{"640x480":["2087932-1","2087932-2","2087932-3"]}]}},"thirtythreeacross":{"test":false,"enabled":true,"tag_ids":{"mobile":[{"320x50":["dTiqc4ZFOr66bCaKj0P0Le","dX5kpOZFOr66bCaKj0P0Le","d29WcMZFOr66bCaKj0P0Le","d78XbEZFOr66bCaKj0P0Le"],"300x250":["dTiqc4ZFOr66bCaKj0P0Le","dX5kpOZFOr66bCaKj0P0Le"]}],"desktop":[{"728x90":["dikp1mZFOr66bCaKj0P0Le","dnk45OZFOr66bCaKj0P0Le","dITmVMZFOr66bCaKj0P0Le","dN7rR6ZFOr66bCaKj0P0Le"],"160x600":["dBSR_eZFOr66bCaKj0P0Le","dxcRH4ZFOr66bCaKj0P0Le"],"300x250":["dikp1mZFOr66bCaKj0P0Le","dnk45OZFOr66bCaKj0P0Le","dsmFFgZFOr66bCaKj0P0Le","dxcRH4ZFOr66bCaKj0P0Le"],"300x600":["dxcRH4ZFOr66bCaKj0P0Le"],"970x250":["dITmVMZFOr66bCaKj0P0Le","dN7rR6ZFOr66bCaKj0P0Le"]}]}},"appnexus_outstream":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["22332400","22332402","22332403"]}],"desktop":[{"640x480":["22332395","22332397","22332399"]}]}},"pubmatic_outstream":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"rhythmone_instream":{"enabled":true,"site_id":"235414","tag_ids":{"mobile":[{"400x300":["mobile-1"]}],"desktop":[{"640x480":["desktop-1"]}]}},"amazon_tam_instream":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["instream_1"]}],"desktop":[{"640x480":["instream_1"]}]}},"beachfront_instream":{"enabled":true,"site_id":"97cf62d8-6728-484a-88c1-d1f996bfa146","tag_ids":{"mobile":[{"400x300":["mobile-1"]}],"desktop":[{"640x480":["desktop-1"]}]}},"rhythmone_outstream":{"enabled":true,"site_id":"237099","tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"beachfront_outstream":{"enabled":true,"site_id":"eb1985cf-693d-419b-ee26-3d1a81c96314","tag_ids":{"mobile":[{"400x300":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"640x480":["desktop-1","desktop-2","desktop-3"]}]}},"thirtythreeacross_instream":{"enabled":true,"tag_ids":{"mobile":[{"400x300":["b8yynQfJ8r7ikTaKj0P0Le"]}],"desktop":[{"640x480":["dOdUdcfJ4r7ikTaKj0P0Le"]}]}}}},"refresh":{"mobile":{"max":10,"enabled":true,"interval":60000,"exclude_dfp":0,"inview_interval":3000},"desktop":{"max":10,"enabled":true,"interval":60000,"exclude_dfp":0,"inview_interval":3000}},"userIds":{"identityAdapters":{"id5id":{"name":"id5Id","config":{"enabled":true},"storage":{"name":"id5id","type":"localstorage","expiresInDays":90,"refreshInSeconds":28800}},"publink":{"name":"pubLink","config":{"enabled":true},"storage":{"name":"publink","type":"cookie","expiresInDays":30}},"sharedid":{"name":"sharedId","config":{"enabled":true},"storage":{"name":"sharedid","type":"cookie","expiresInDays":30,"refreshInSeconds":86400}},"fabrickid":{"name":"fabrickId","config":{"apiKey":null,"enabled":false},"storage":{"name":"fabrickId","type":"cookie","expiresInDays":7}},"pubcommonid":{"name":"pubCommonId","config":{"enabled":true},"storage":{"name":"_pubcid","type":"localstorage","expiresInDays":365}},"identitylink":{"name":"identityLink","config":{"enabled":true,"urlParameter":""},"storage":{"name":"idl_env","type":"cookie","expiresInDays":30}},"verizonmediaid":{"name":"verizonMediaId","config":{"enabled":true},"storage":{"name":"connectid","type":"localstorage","expiresInDays":15}}}},"ad_slots":{"video":{"upi_instream_1":{"number":1,"sticky":false,"mcm_type":"mcm","video_player":"upi_instream","resolution_size_map":{"0":["400x300"],"768":["640x480"]}}},"display":{"upi_left_1":{"number":2,"sticky":false,"dynamic":{"mobile":{"enabled":false,"cssselector":".proper-left-1","cssplacement":"append"},"desktop":{"enabled":false,"cssselector":".proper-left-1","cssplacement":"append"}},"resolution_size_map":{"0":[],"1660":["160x600"]}},"upi_sticky":{"number":8,"sticky":true,"dynamic":{"mobile":{"enabled":false,"cssselector":".proper-sticky","cssplacement":"append"},"desktop":{"enabled":false,"cssselector":".proper-sticky","cssplacement":"append"}},"refresh":{"mobile":{"enabled":true,"interval":30000},"desktop":{"enabled":true,"interval":30000}},"sticky_settings":{"brand":true,"close_btn":true},"resolution_size_map":{"0":["320x50","sticky_horizontal"],"768":["728x90","sticky_horizontal"],"1000":["728x90","970x90","sticky_horizontal"]}},"upi_right_1":{"number":3,"sticky":false,"dynamic":{"mobile":{"enabled":false,"cssselector":".proper-right-1","cssplacement":"append"},"desktop":{"enabled":false,"cssselector":".proper-right-1","cssplacement":"append"}},"refresh":{"mobile":{"enabled":true,"interval":30000},"desktop":{"enabled":true,"interval":30000}},"lazyload":{"mobile":{"enabled":true,"fetchMarginPercent":1,"renderMarginPercent":1},"desktop":{"enabled":true},"device_specific":true},"resolution_size_map":{"0":["300x250","320x50"],"901":["300x250","native_vertical"]}},"upi_right_2":{"number":5,"sticky":false,"dynamic":{"mobile":{"enabled":false,"cssselector":".proper-right-2","cssplacement":"append"},"desktop":{"enabled":false,"cssselector":".proper-right-2","cssplacement":"append"}},"refresh":{"mobile":{"enabled":true,"interval":30000},"desktop":{"enabled":true,"interval":30000}},"lazyload":{"mobile":{"enabled":true,"fetchMarginPercent":1,"renderMarginPercent":1},"desktop":{"enabled":true},"device_specific":true},"resolution_size_map":{"0":["300x250","320x50"],"901":["300x250","native_vertical"]}},"upi_right_3":{"number":6,"sticky":false,"mcm_type":"mcm","resolution_size_map":{"0":[],"901":["160x600","300x250","300x600","native_vertical"]}},"upi_slideshow":{"number":9,"sticky":false,"mcm_type":"mcm","resolution_size_map":{"0":[],"901":["300x600","300x250","160x600","native_vertical"]}},"upi_quiz_right":{"number":10,"sticky":false,"refresh":{"mobile":{"enabled":true,"interval":15000},"desktop":{"enabled":true,"interval":15000}},"mcm_type":"mcm","resolution_size_map":{"0":[],"901":["300x250","300x600","native_vertical","160x600"]}},"upi_leaderboard":{"number":1,"sticky":false,"dynamic":{"mobile":{"enabled":false,"cssselector":".proper-leaderboard","cssplacement":"append"},"desktop":{"enabled":false,"cssselector":".proper-leaderboard","cssplacement":"append"}},"resolution_size_map":{"0":["320x50"],"768":["728x90"],"1000":["970x250","728x90"]}},"upi_content_dynamic":{"number":7,"sticky":false,"dynamic":{"mobile":{"enabled":true,"cssselector":".upi-content","cssplacement":"after"},"desktop":{"enabled":true,"cssselector":".upi-content","cssplacement":"after"}},"lazyload":{"mobile":{"enabled":true},"desktop":{"enabled":true},"device_specific":true},"video_player":"upi_outstream","video_enabled":true,"resolution_size_map":{"0":["300x250","320x50","400x300"],"768":["300x250","640x480"]}},"upi_gallery_right_1":{"number":4,"sticky":false,"dynamic":{"mobile":{"enabled":false,"cssselector":".proper-right-1","cssplacement":"append"},"desktop":{"enabled":false,"cssselector":".proper-right-1","cssplacement":"append"}},"refresh":{"mobile":{"enabled":true,"interval":15000},"desktop":{"enabled":true,"interval":15000}},"resolution_size_map":{"0":[],"901":["300x250","native_vertical","300x600","160x600"]}}}},"auctions":{"mobile":{"max":10,"rounds":1,"timeout":58000},"desktop":{"max":10,"rounds":1,"timeout":58000},"resolution_size_map":{"0":["320x50","sticky_horizontal","300x250","400x300"],"768":["728x90","sticky_horizontal","300x250","640x480"],"901":["300x250","native_vertical","160x600","300x600"],"1000":["728x90","970x90","sticky_horizontal","970x250"],"1660":["160x600"]}},"lazyload":{"mobile":{"enabled":true,"fetchMarginPercent":100,"renderMarginPercent":100},"desktop":{"enabled":true,"fetchMarginPercent":85,"renderMarginPercent":85},"device_specific":true},"mcm_type":"mcm","site_name":"upi","dfp_per_slot":0,"video_players":{"upi_instream":{"player_settings":{"autoplay":true,"backfill":false,"video_id":"","video_type":"instream","backfill_id":"","dfp_ad_unit":"upi_instream_1","small_player":"never","number_of_ads":5,"ad_failure_limit":5,"no_ads_no_player":false,"small_player_bottom":100}},"upi_outstream":{"player_settings":{"autoplay":true,"backfill":false,"video_id":"","video_type":"outstream","backfill_id":"","dfp_ad_unit":"","small_player":"never","number_of_ads":10,"ad_failure_limit":5,"no_ads_no_player":true,"small_player_bottom":100}}},"report_ad_tool":false,"sandbox_iframe":1,"sandbox_options":["allow-pointer-lock","allow-popups","allow-same-origin","allow-scripts"],"rtp_file_version":9141,"domain_protection":true,"google_advertiser":42904576,"proper_advertiser":600883576,"rtp_file_revision":"1.82.0","additional_domains":[],"traffic_percentage":1}};

		// Traffic Percentages
		var traffic_percentages = {"9141":1};
		var getVersionId = weightedRandom(traffic_percentages);

		function run() {
			// Init version id
			var version_id   = null,
				clear_cookie = false,
				config 		 = null;

			// Check for clear cookie flag
			var get_vars = getUrlParameters(window.location.search.substring(1));
			if(typeof get_vars["vselect_clear"] !== "undefined" && get_vars["vselect_clear"] == 1) {
				clear_cookie = true;
			}
			// Check for version id in url
			if(typeof get_vars["vselect"] !== "undefined" && get_vars["vselect"] && rtp_files[get_vars["vselect"]]) {
				version_id = get_vars["vselect"];
			}

			// Check for session persistent
			if(session_persistent) {
				// Get cookie data
				getSplitTestCookie();

				// Convert dates
				d1 = new Date(cookieData['release_ts']);
				d2 = new Date(last_release_ts);

				// Check if cookie data is out of date
				if(d1 < d2 || !cookieData['version_id'] || !rtp_files[cookieData['version_id']] || version_id || clear_cookie) {
					cookieData['version_id'] = version_id || getVersionId();  // Generate version id based on traffic share
					cookieData['release_ts'] = last_release_ts;   // Update release ts
				}
				// Set new cookie data
				setSplitTestCookie();

				version_id = cookieData['version_id'];
			} else {
				// Generate version id based on traffic share
				version_id = version_id || getVersionId();
			}

			// Check if proper ad block message should be enabled
			activateAdBlockMsg();

			var versions = Object.keys(rtp_files);
			// Find and Activate Config Object.
			if (rtp_files[version_id]) {
				if (versions.length == 1) {
					var config = rtp_files[version_id];
					activatePayload(config.rtp_file_revision);
					activateConfig(config);
				} else {
					var payload_name = rtp_files[version_id];
					activatePayload(payload_name);
					fetchConfig(version_id, function (config) {
						activateConfig(config);
					});
				}
			}
		}

		/**
		 * Activate the Config Object.
		 *
		 * @param {object} config RtpJ Config Object.
		 */
		function activateConfig(config) {
			propertag.cmd.unshift(function () {
				ProperMedia.ad_project.set_options(config);
			});
		}

		/**
		 * Add event listener of ad blockers to show proper ad block message
		 */
		function activateAdBlockMsg() {
			if(proper_ad_block_message) {
				window.addEventListener("proper-ad-bidders-blocked", loadProperMessage);
			}
		}

		/**
         * Load Proper Ad Block Message
         */
        function loadProperMessage() {

            function showProperMessage() {
                try {
                    var ProperMediaMessage = window.ProperMediaMessage || {};
                    ProperMediaMessage.project.show_shield_message('', publisher);
                } catch(e) {
                    console.error(e);
                }
            }

            if(
                !window.ProperMediaMessage ||
                !window.ProperMediaMessage.project ||
                !window.ProperMediaMessage.show_shield_message
            ) {
                var script = document.createElement("script");
                script.type = "text/javascript";
                script.src = "https://propermessage.io/design/assets/bundle-message.js";
                script.onload = showProperMessage;
                document.getElementsByTagName("head")[0].appendChild(script);
            } else {
                showProperMessage()
            }
        }

		/**
		 * Grab the Config from the remote server.
		 *
		 * @param {*} version_id The Version Id to fetch.
		 * @param {*} callback Function that will be passed the parsed config.
		 */
		function fetchConfig(version_id, callback) {
			var req = new XMLHttpRequest();

			var listener = function () {
				var config = safeJsonParse(this.responseText);
				if(typeof callback == 'function') {
					callback(config);
				}
			};

			req.addEventListener("load", listener);
			req.open("GET", "https://" + ad_code_domain + "/config/" + publisher + "." + version_id + '.json');
			req.send();
		}

		/**
		 * Activate the Payload!
		 *
		 * @param {string} payload_name The Payload Release Name.
		 */
		function activatePayload(payload_name) {
			// Main ad code file
			var script = document.createElement("script");

			script.onerror = function() {
				payload_loaded = false;
                // Payload was blocked, trigger this event
                var event = new CustomEvent('proper-ad-bidders-blocked', {});
                window.dispatchEvent(event);
            }

        	payload_loaded = true;
			var payload = 'https://' + ad_code_domain + '/payloads/' + payload_name + '.js';
			script.type = "text/javascript";
			script.src = payload;
			document.getElementsByTagName("head")[0].appendChild(script);
		}

		// Weighted Random @see https://stackoverflow.com/questions/8435183/generate-a-weighted-random-number
		function weightedRandom(spec) {
			if (!spec) {
				return function() {};
			}

			var ids = Object.keys(spec);

			if (ids.length == 1) {
				return function () { return ids[0] };
			}

			var i, j, table = [];
			for (i in spec) {
				// The constant 10 below should be computed based on the
				// weights in the spec for a correct and optimal table size.
				// E.g. the spec {0:0.999, 1:0.001} will break this impl.
				for (j=0; j<spec[i]*10; j++) {
					table.push(i);
				}
			}
			return function() {
				return table[Math.floor(Math.random() * table.length)];
			}
		}

		function getSplitTestCookie() {
			// Get cookie value
			var cookie_string_value = getCookieValue(cookie_name) || '{}';

			// Set settion object
			var cookieSplitTestData = safeJsonParse(cookie_string_value) || {};
			cookieData = {
				"version_id": cookieSplitTestData['version_id'] || null,
				"release_ts": cookieSplitTestData['release_ts'] || null
			}
		}

		function setSplitTestCookie() {
			// stringify data
			var encoded_cookie_value = JSON.stringify(cookieData);
			// save session cookie
			setCookieValue(encoded_cookie_value);
		}

		function getCookieValue(a) {
			var b = document.cookie.match('(^|;)\\s*' + a + '\\s*=\\s*([^;]+)');
			return b ? b.pop() : undefined;
		}

		function setCookieValue(value) {
			document.cookie = cookie_name + "=" + value + "; path=/;";
		}

		function getUrlParameters(url) {
			var data = decodeURIComponent(url).split('&');
			var res = {};
			for (var i = 0; i < data.length; i++) {
				var parm = data[i].split('=');
				res[parm[0]] = parm[1];
			}
			return res;
		}

		/**
		 * safeJSONParse
		 *
		 * Makes an attempt to parse a JSON safely, but might fail miserably.
		 *
		 * @param {String} the json
		 *
		 * @returns {JSON|null} JSON is parsed, Null if not.
		 *
		 */
		function safeJsonParse(json) {
			try {
				return JSON.parse(json);
			} catch(e) {
				console.error(e);
			}
			return null;
		}

		/**
         * CustomEvent polyfill for IE
         */
        if(!window.CustomEvent !== "function" ) {
            window.CustomEvent = function CustomEvent ( event, params ) {
                params = params || { bubbles: false, cancelable: false, detail: null };
                var evt = document.createEvent( 'CustomEvent' );
                evt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );
                return evt;
            }
		};

		// Placeholder for Google Funding Choices.
		

		run();

	})(window, document);
} catch (e) {
	console.error(e);
	if(typeof TraceKit !== "undefined") {
		TraceKit.report(e); //error with stack trace gets normalized and sent to subscriber
	}
}
